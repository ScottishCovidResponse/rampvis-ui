server {
  root /usr/share/nginx/html;

  ## Avoid unwanted hostname modifications when redirecting
  ## https://serverfault.com/a/834139/161935
  absolute_redirect off;

  ## Disable logs to avoid noise in stdout
  access_log off;
  error_log off;

  ## Use a 404 page generated by Next.js
  error_page 404 /404.html;

  ## Donâ€™t redirect to /404
  location = /404.html {
    internal;
  }

  ## Cache static assets to improve app performance
  location /_next/static {
    add_header Cache-Control "max-age=31536000";
  }

  location / {
    ## Avoid caching between rebuilds
    add_header Cache-Control "no-cache";

    ## Remove trailing slashes
    rewrite ^(/.*)/$ $1 permanent;

    ## Remove /index(.htm(l))
    rewrite ^(/.*)index(.html?)?$ $1 permanent;

    ## Remove .htm(l) extension
    rewrite ^(/.*)\.html?(\?.*)?$ $1$2 permanent;

    ## Serve an HTML page
    try_files $uri.html $uri/index.html $uri =404;
  }
}
